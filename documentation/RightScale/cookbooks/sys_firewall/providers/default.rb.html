<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: RightScale::cookbooks::sys_firewall::providers::default.rb
  
    &mdash; Documentation by YARD 0.7.4
  
</title>

  <link rel="stylesheet" href="../../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../../_index.html">Index (d)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../../RightScale.html" title="RightScale (module)">RightScale</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../cookbooks.html" title="RightScale::cookbooks (class)">cookbooks</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../sys_firewall.html" title="RightScale::cookbooks::sys_firewall (class)">sys_firewall</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../providers.html" title="RightScale::cookbooks::sys_firewall::providers (class)">providers</a></span></span>
     &raquo; 
    <span class="title">default.rb</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: RightScale::cookbooks::sys_firewall::providers::default.rb
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">RightScale::cookbooks::sys_firewall::providers::default.rb</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">cookbooks/sys_firewall/providers/default.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <h1>Cookbook Name:: sys_firewall</h1>
<pre class="code">
 Copyright RightScale, Inc. All rights reserved.  All access and use subject to the
 RightScale Terms of Service available at http://www.rightscale.com/terms.php and,
 if applicable, other agreements such as a RightScale Master Subscription Agreement.</pre>


  </div>
</div>
<div class="tags">
  

</div>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (Object) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_request-instance_method" title="#update_request (instance method)">- (Object) <strong>update_request</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
action.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="update-instance_method">
  
    - (<tt>Object</tt>) <strong>update</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'cookbooks/sys_firewall/providers/default.rb', line 10</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:update</span> <span class='kw'>do</span>
  
  <span class='comment'># Set local variables from attributes
</span>  <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span> <span class='op'>?</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span> <span class='op'>:</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: port must be set</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_protocol'>protocol</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span>
  <span class='id identifier rubyid_to_enable'>to_enable</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_enable'>enable</span>
  <span class='id identifier rubyid_ip_addr'>ip_addr</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_ip_addr'>ip_addr</span>
  <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_machine_tag'>machine_tag</span>
  <span class='id identifier rubyid_ip_tag'>ip_tag</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>server:private_ip_0</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_collection_name'>collection_name</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_collection'>collection</span>
  
  <span class='comment'># We only support ip_addr or tags, however, ip_addr defaults to 'any' so reconcile here
</span>  <span class='id identifier rubyid_ip_addr'>ip_addr</span><span class='period'>.</span><span class='id identifier rubyid_downcase!'>downcase!</span>
  <span class='id identifier rubyid_ip_addr'>ip_addr</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_ip_addr'>ip_addr</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>any</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_tag'>tag</span>  <span class='comment'># tags win, so clear 'any'
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: ip_addr param cannot be used with machine_tag param.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ip_addr'>ip_addr</span>

  <span class='comment'># Tell user what is going on
</span>  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_enable'>to_enable</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enabling</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Disabling</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='tstring_content'> firewall rule for port </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> only for address </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip_addr'>ip_addr</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_ip_addr'>ip_addr</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> on servers with tag </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tag'>tag</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> using protocol </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_protocol'>protocol</span>
  <span class='id identifier rubyid_log'>log</span> <span class='id identifier rubyid_msg'>msg</span>

  <span class='comment'># Update rules 
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='symbol'>:sys_firewall</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:enabled</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>enabled</span><span class='tstring_end'>&quot;</span></span> 
    <span class='id identifier rubyid_log'>log</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Firewall not enabled. Not adding rule for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    
    <span class='comment'># Setup iptables rebuild resouce 
</span>    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rebuild-iptables</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_command'>command</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/sbin/rebuild-iptables</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:nothing</span>
    <span class='kw'>end</span>
  
    <span class='id identifier rubyid_rs_utils_server_collection'>rs_utils_server_collection</span> <span class='id identifier rubyid_collection_name'>collection_name</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_tags'>tags</span> <span class='id identifier rubyid_tag'>tag</span>
      <span class='id identifier rubyid_secondary_tags'>secondary_tags</span> <span class='id identifier rubyid_ip_tag'>ip_tag</span>
      <span class='id identifier rubyid_only_if'>only_if</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_tag'>tag</span> <span class='op'>!=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_ruby_block'>ruby_block</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Register all currently active app servers</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_block'>block</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_ip_list'>ip_list</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='rbracket'>]</span>

        <span class='comment'># Add specific ip address 
</span>        <span class='id identifier rubyid_ip_list'>ip_list</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ip_addr'>ip_addr</span> <span class='kw'>if</span> <span class='id identifier rubyid_ip_addr'>ip_addr</span>

        <span class='comment'># Add tagged servers
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span>
          <span class='id identifier rubyid_valid_ip_regex'>valid_ip_regex</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])</span><span class='tstring_end'>'</span></span>
          <span class='id identifier rubyid_ip_list'>ip_list</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='symbol'>:server_collection</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_collection_name'>collection_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_tags'>tags</span><span class='op'>|</span>
            <span class='const'>RightScale</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Helper</span><span class='period'>.</span><span class='id identifier rubyid_get_tag_value'>get_tag_value</span><span class='lparen'>(</span><span class='id identifier rubyid_ip_tag'>ip_tag</span><span class='comma'>,</span> <span class='id identifier rubyid_tags'>tags</span><span class='comma'>,</span> <span class='id identifier rubyid_valid_ip_regex'>valid_ip_regex</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span> <span class='comment'># if tag
</span>                  
        <span class='comment'># Use iptables cookbook to create open/close port for ip list
</span>        <span class='id identifier rubyid_ip_list'>ip_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ip'>ip</span><span class='op'>|</span>
  
          <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Updating iptables rule for IP Address: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip'>ip</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  
          <span class='id identifier rubyid_rule'>rule</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>port_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_rule'>rule</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip'>ip</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>_</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> 
                    
          <span class='comment'># Programatically execute template resource
</span>          <span class='const'>RightScale</span><span class='op'>::</span><span class='const'>System</span><span class='op'>::</span><span class='const'>Helper</span><span class='period'>.</span><span class='id identifier rubyid_run_template'>run_template</span><span class='lparen'>(</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/etc/iptables.d/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rule'>rule</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>    <span class='comment'># target_file
</span>                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iptables_port.erb</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>          <span class='comment'># source
</span>                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sys_firewall</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>               <span class='comment'># cookbook
</span>                <span class='lbrace'>{</span>                             <span class='comment'># variables
</span>                  <span class='symbol'>:port</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span>
                  <span class='symbol'>:protocol</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_protocol'>protocol</span><span class='comma'>,</span>
                  <span class='symbol'>:ip_addr</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_ip'>ip</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>any</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_ip'>ip</span> 
                <span class='rbrace'>}</span><span class='comma'>,</span> 
                <span class='id identifier rubyid_to_enable'>to_enable</span><span class='comma'>,</span>                    <span class='comment'># enable
</span>                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/sbin/rebuild-iptables</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='comment'># command to run
</span>                <span class='id identifier rubyid_node'>node</span><span class='comma'>,</span> 
                <span class='ivar'>@run_context</span><span class='rparen'>)</span>
        <span class='kw'>end</span> <span class='comment'># each
</span>          
          
      <span class='kw'>end</span> <span class='comment'># block
</span>    <span class='kw'>end</span> <span class='comment'># ruby_block
</span>            
  <span class='kw'>end</span> <span class='comment'># else
</span>  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update_request-instance_method">
  
    - (<tt>Object</tt>) <strong>update_request</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
action
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'cookbooks/sys_firewall/providers/default.rb', line 100</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:update_request</span> <span class='kw'>do</span>
  

  <span class='comment'># Deal with attributes
</span>  <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span> <span class='op'>?</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span> <span class='op'>:</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_to_enable'>to_enable</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_enable'>enable</span>
  <span class='id identifier rubyid_ip_addr'>ip_addr</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_ip_addr'>ip_addr</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: client_ip must be specified.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_ip_addr'>ip_addr</span>
  <span class='id identifier rubyid_tag'>tag</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_machine_tag'>machine_tag</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: machine_tag must be specified.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_tag'>tag</span>

  <span class='comment'># Tell user what is going on
</span>  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Requesting port </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='rbrace'>}</span><span class='tstring_content'> be </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_to_enable'>to_enable</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>opened</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>closed</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> only for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ip_addr'>ip_addr</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_ip_addr'>ip_addr</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> on servers with tag: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tag'>tag</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_log'>log</span> <span class='id identifier rubyid_msg'>msg</span>
  
  <span class='comment'># Setup attributes
</span>  <span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='symbol'>:sys_firewall</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:rule</span> <span class='op'>=&gt;</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rbrace'>}</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:sys_firewall</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:rule</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:port</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_port'>port</span>
  <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:sys_firewall</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:rule</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:enable</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_to_enable'>to_enable</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>enable</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>disable</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='symbol'>:sys_firewall</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:rule</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:ip_address</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_ip_addr'>ip_addr</span>
  
  <span class='comment'># Use RightNet to update firewall rules on all tagged servers
</span>  <span class='id identifier rubyid_remote_recipe'>remote_recipe</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Request firewall update</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_recipe'>recipe</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sys_firewall::setup_rule</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_recipients_tags'>recipients_tags</span> <span class='id identifier rubyid_tag'>tag</span>
    <span class='id identifier rubyid_attributes'>attributes</span> <span class='id identifier rubyid_attrs'>attrs</span>
  <span class='kw'>end</span> 

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Jan  3 15:23:10 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.9.2).
</div>

  </body>
</html>